<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Enhanced Data Mining for Cholera Surveillance Gaps</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #0167af 0%, #014d82 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .mosaic-logo {
            height: 80px;
            width: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
        }
        
        .header-text {
            text-align: left;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .header-text {
                text-align: center;
            }
            
            .mosaic-logo {
                height: 60px;
                width: 60px;
                font-size: 1.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .last-updated {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-card.completed {
            border-left-color: #28a745;
        }
        
        .stat-card.pending {
            border-left-color: #ffc107;
        }
        
        .stat-card.not-started {
            border-left-color: #dc3545;
        }
        
        .stat-card.overview {
            border-left-color: #0167af;
        }
        
        .stat-icon {
            font-size: 2rem;
            opacity: 0.8;
        }
        
        .stat-icon.completed { color: #28a745; }
        .stat-icon.pending { color: #ffc107; }
        .stat-icon.not-started { color: #dc3545; }
        .stat-icon.overview { color: #0167af; }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.15rem;
        }
        
        .stat-label {
            color: #666;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .progress-container {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .progress-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .progress-bar {
            width: 100%;
            height: 16px;
            background-color: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            border-radius: 8px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
            color: #666;
            margin-top: 0.25rem;
            font-size: 0.9rem;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .table-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .table-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .search-box {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            min-width: 200px;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
        }
        
        th:hover {
            background: #e9ecef;
        }
        
        th i {
            margin-left: 0.5rem;
            opacity: 0.5;
        }
        
        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tbody tr:hover {
            background: #e3f2fd;
        }
        
        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-not-started {
            background: #f8d7da;
            color: #721c24;
        }
        
        .country-stats {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }
        
        .country-stats strong {
            color: #333;
        }
        
        .auto-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #0167af;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 25px;
            font-size: 0.85rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .auto-refresh i {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .stat-number {
                font-size: 1.75rem;
            }
            
            .stat-icon {
                font-size: 1.5rem;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: auto;
            }
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .summary-card {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .summary-card h3 {
            color: #0167af;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }
        
        .summary-list {
            list-style: none;
            padding: 0;
        }
        
        .summary-list li {
            padding: 0.4rem 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .summary-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="mosaic-logo">
                M
            </div>
            
            <div class="header-text">
                <h1>AI Enhanced Data Mining for Cholera Surveillance Gaps</h1>
                <p>Protocol Version 3.0 - 6-Agent Batch-Based Search Protocol</p>
                <p class="last-updated">Last Updated: <span id="last-updated"></span></p>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card completed">
                <i class="fas fa-check-circle stat-icon completed"></i>
                <div class="stat-content">
                    <div class="stat-number" id="completed-count">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>
            
            <div class="stat-card pending">
                <i class="fas fa-clock stat-icon pending"></i>
                <div class="stat-content">
                    <div class="stat-number" id="pending-count">0</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
            
            <div class="stat-card not-started">
                <i class="fas fa-circle stat-icon not-started"></i>
                <div class="stat-content">
                    <div class="stat-number" id="not-started-count">0</div>
                    <div class="stat-label">Not Started</div>
                </div>
            </div>
            
            <div class="stat-card overview">
                <i class="fas fa-globe-africa stat-icon overview"></i>
                <div class="stat-content">
                    <div class="stat-number" id="total-count">0</div>
                    <div class="stat-label">Total Countries</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <i class="fas fa-chart-line"></i>
                <span>Overall Progress</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">Loading...</div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <h3><i class="fas fa-trophy"></i> Recent Completions</h3>
                <ul class="summary-list" id="recent-completions">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
            
            <div class="summary-card">
                <h3><i class="fas fa-chart-bar"></i> Data Summary</h3>
                <ul class="summary-list" id="data-summary">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
        </div>

        <!-- Countries Table -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-table"></i>
                    <span>Country Status</span>
                </div>
                <input type="text" class="search-box" id="searchInput" placeholder="Search countries..." onkeyup="filterTable()">
            </div>
            <div class="table-wrapper">
                <table id="countryTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Country <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable(1)">ISO <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable(2)">Status <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable(3)">Last Updated <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable(4)">Data Summary <i class="fas fa-sort"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="auto-refresh">
        <i class="fas fa-sync-alt"></i>
        <span>Auto-refresh: 30s</span>
    </div>

    <script>
        // Embedded CSV data - updated automatically by the Python script
        const csvData = `country,iso,status,datetime,sources,observations,date_range,priority,execution_time,queries,yield_pct,notes
Angola,AGO,COMPLETED,2025-07-21 22:23:00,24,34,1987-2025,LOW,0,3,2933.3,All agents executed; 34 data observations
Burundi,BDI,COMPLETED,2025-07-22 09:21:58,13,35,1986-2025,LOW,0,0,,Quality audit completed; 35 data observations
Benin,BEN,COMPLETED,2025-07-22 12:38:38,15,23,1996-2022,MEDIUM,0,0,,All agents executed; 23 data observations
Burkina Faso,BFA,COMPLETED,2025-07-22 15:49:51,11,12,1971-2021,HIGH,0,3,1500.0,All agents executed; 12 data observations
Botswana,BWA,PENDING,2025-07-22 10:58:26,0,0,,,0,1,,Agent 1 completed
Central African Republic,CAF,PENDING,2025-07-22 10:57:15,0,0,,,0,0,,Agent 1 completed
Côte d'Ivoire,CIV,NOT_STARTED,,0,0,,,0,0,,No activity detected
Cameroon,CMR,COMPLETED,2025-07-22 15:03:50,24,33,2001-2024,LOW,0,0,,All agents executed; 33 data observations
Democratic Republic of Congo,COD,NOT_STARTED,,0,0,,,0,0,,No activity detected
Congo,COG,NOT_STARTED,,0,0,,,0,0,,No activity detected
Eritrea,ERI,NOT_STARTED,,0,0,,,0,0,,No activity detected
Ethiopia,ETH,NOT_STARTED,,0,0,,,0,0,,No activity detected
Gabon,GAB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Ghana,GHA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Guinea,GIN,NOT_STARTED,,0,0,,,0,0,,No activity detected
Gambia,GMB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Guinea-Bissau,GNB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Equatorial Guinea,GNQ,NOT_STARTED,,0,0,,,0,0,,No activity detected
Kenya,KEN,NOT_STARTED,,0,0,,,0,0,,No activity detected
Liberia,LBR,NOT_STARTED,,0,0,,,0,0,,No activity detected
Mali,MLI,NOT_STARTED,,0,0,,,0,0,,No activity detected
Mozambique,MOZ,NOT_STARTED,,0,0,,,0,0,,No activity detected
Mauritania,MRT,NOT_STARTED,,0,0,,,0,0,,No activity detected
Malawi,MWI,NOT_STARTED,,0,0,,,0,0,,No activity detected
Namibia,NAM,NOT_STARTED,,0,0,,,0,0,,No activity detected
Niger,NER,NOT_STARTED,,0,0,,,0,0,,No activity detected
Nigeria,NGA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Rwanda,RWA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Senegal,SEN,NOT_STARTED,,0,0,,,0,0,,No activity detected
Sierra Leone,SLE,NOT_STARTED,,0,0,,,0,0,,No activity detected
Somalia,SOM,NOT_STARTED,,0,0,,,0,0,,No activity detected
South Sudan,SSD,NOT_STARTED,,0,0,,,0,0,,No activity detected
Eswatini,SWZ,NOT_STARTED,,0,0,,,0,0,,No activity detected
Chad,TCD,NOT_STARTED,,0,0,,,0,0,,No activity detected
Togo,TGO,NOT_STARTED,,0,0,,,0,0,,No activity detected
Tanzania,TZA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Uganda,UGA,NOT_STARTED,,0,0,,,0,0,,No activity detected
South Africa,ZAF,NOT_STARTED,,0,0,,,0,0,,No activity detected
Zambia,ZMB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Zimbabwe,ZWE,NOT_STARTED,,0,0,,,0,0,,No activity detected`;

        let countryData = [];

        // Parse CSV data
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    const country = {};
                    headers.forEach((header, index) => {
                        country[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(country);
                }
            }
            return data;
        }

        // Parse a single CSV line handling commas in quoted fields
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        // Initialize dashboard
        function initializeDashboard() {
            countryData = parseCSV(csvData);
            updateStats();
            updateProgressBar();
            updateTable();
            updateSummaryCards();
            updateLastUpdated();
        }

        // Update statistics
        function updateStats() {
            const completed = countryData.filter(c => c.status === 'COMPLETED').length;
            const pending = countryData.filter(c => c.status === 'PENDING').length;
            const notStarted = countryData.filter(c => c.status === 'NOT_STARTED').length;
            const total = countryData.length;

            document.getElementById('completed-count').textContent = completed;
            document.getElementById('pending-count').textContent = pending;
            document.getElementById('not-started-count').textContent = notStarted;
            document.getElementById('total-count').textContent = total;
        }

        // Update progress bar
        function updateProgressBar() {
            const completed = countryData.filter(c => c.status === 'COMPLETED').length;
            const total = countryData.length;
            const progressPercent = total > 0 ? (completed / total * 100) : 0;

            document.getElementById('progress-bar').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = 
                `${progressPercent.toFixed(1)}% Complete (${completed} of ${total} countries)`;
        }

        // Update the countries table
        function updateTable() {
            const tbody = document.querySelector('#countryTable tbody');
            tbody.innerHTML = '';

            countryData.forEach(country => {
                const row = document.createElement('tr');
                
                const statusBadge = getStatusBadge(country.status);
                const stats = getStatsString(country);
                const lastUpdated = formatDate(country.datetime);
                
                row.innerHTML = `
                    <td><strong>${country.country || 'Unknown'}</strong></td>
                    <td><code>${country.iso || 'N/A'}</code></td>
                    <td>${statusBadge}</td>
                    <td>${lastUpdated}</td>
                    <td><div class="country-stats">${stats}</div></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Get status badge HTML
        function getStatusBadge(status) {
            const badges = {
                'COMPLETED': '<span class="status-badge status-completed"><i class="fas fa-check"></i> Completed</span>',
                'PENDING': '<span class="status-badge status-pending"><i class="fas fa-clock"></i> Pending</span>',
                'NOT_STARTED': '<span class="status-badge status-not-started"><i class="fas fa-circle"></i> Not Started</span>'
            };
            return badges[status] || badges['NOT_STARTED'];
        }

        // Get stats string
        function getStatsString(country) {
            if (country.status === 'COMPLETED') {
                const sources = country.sources || '0';
                const observations = country.observations || '0';
                const dateRange = country.date_range && country.date_range !== 'N/A' ? country.date_range : 'Unknown period';
                return `<strong>Sources:</strong> ${sources} | <strong>Observations:</strong> ${observations}<br><strong>Coverage:</strong> ${dateRange}`;
            } else if (country.status === 'PENDING') {
                return country.notes || 'Work in progress';
            }
            return 'No activity detected';
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString || dateString === 'N/A') {
                return '-';
            }
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch (e) {
                return dateString;
            }
        }

        // Update summary cards
        function updateSummaryCards() {
            // Recent completions
            const completed = countryData
                .filter(c => c.status === 'COMPLETED')
                .sort((a, b) => new Date(b.datetime) - new Date(a.datetime))
                .slice(0, 5);

            const recentList = document.getElementById('recent-completions');
            recentList.innerHTML = '';
            
            if (completed.length === 0) {
                recentList.innerHTML = '<li><span>No completions yet</span></li>';
            } else {
                completed.forEach(country => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span><strong>${country.country}</strong> (${country.iso})</span>
                        <span>${formatDate(country.datetime).split(' ')[0]}</span>
                    `;
                    recentList.appendChild(li);
                });
            }

            // Data summary
            const totalSources = countryData.reduce((sum, c) => sum + (parseInt(c.sources) || 0), 0);
            const totalObservations = countryData.reduce((sum, c) => sum + (parseInt(c.observations) || 0), 0);
            const avgSourcesPerCountry = completed.length > 0 ? Math.round(totalSources / completed.length) : 0;

            const dataSummary = document.getElementById('data-summary');
            dataSummary.innerHTML = `
                <li><span>Total Sources</span><span><strong>${totalSources}</strong></span></li>
                <li><span>Total Observations</span><span><strong>${totalObservations}</strong></span></li>
                <li><span>Avg Sources/Country</span><span><strong>${avgSourcesPerCountry}</strong></span></li>
                <li><span>Countries w/ Data</span><span><strong>${completed.length}</strong></span></li>
            `;
        }

        // Update last updated time
        function updateLastUpdated() {
            document.getElementById('last-updated').textContent = 
                new Date().toISOString().replace('T', ' ').substring(0, 19) + ' UTC';
        }

        // Search functionality
        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("countryTable");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    const txtValue = td.textContent || td.innerText;
                    tr[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
                }
            }
        }

        // Sort table functionality
        function sortTable(n) {
            const table = document.getElementById("countryTable");
            let switching = true;
            let dir = "asc";
            let switchcount = 0;
            
            while (switching) {
                switching = false;
                const rows = table.rows;
                
                for (let i = 1; i < (rows.length - 1); i++) {
                    let shouldSwitch = false;
                    const x = rows[i].getElementsByTagName("TD")[n];
                    const y = rows[i + 1].getElementsByTagName("TD")[n];
                    
                    let xContent = x.textContent || x.innerText;
                    let yContent = y.textContent || y.innerText;
                    
                    if (dir === "asc") {
                        if (xContent.toLowerCase() > yContent.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir === "desc") {
                        if (xContent.toLowerCase() < yContent.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount === 0 && dir === "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        // Auto refresh every 30 seconds
        setInterval(function(){
            location.reload();
        }, 30000);

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>