<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Enhanced Data Mining for Cholera Surveillance Gaps</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #0167af 0%, #014d82 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .mosaic-logo {
            height: 120px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .header-text {
            text-align: left;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .header-text {
                text-align: center;
            }
            
            .mosaic-logo {
                height: 90px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .last-updated {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-card.completed {
            border-left-color: #28a745;
        }
        
        .stat-card.pending {
            border-left-color: #ffc107;
        }
        
        .stat-card.not-started {
            border-left-color: #dc3545;
        }
        
        .stat-card.overview {
            border-left-color: #0167af;
        }
        
        .stat-icon {
            font-size: 1.5rem;
            opacity: 0.8;
        }
        
        .stat-icon.completed { color: #28a745; }
        .stat-icon.pending { color: #ffc107; }
        .stat-icon.not-started { color: #dc3545; }
        .stat-icon.overview { color: #0167af; }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-number {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 0.1rem;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .progress-container {
            background: white;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .progress-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin: 0.25rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            border-radius: 6px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
            color: #666;
            margin-top: 0.15rem;
            font-size: 0.85rem;
        }
        
        .table-container {
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            margin-bottom: 0;
        }
        
        .table-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .table-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .search-box {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            min-width: 200px;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
        }
        
        th:hover {
            background: #e9ecef;
        }
        
        th i {
            margin-left: 0.5rem;
            opacity: 0.5;
        }
        
        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tbody tr:hover {
            background: #e3f2fd;
        }
        
        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-not-started {
            background: #f8d7da;
            color: #721c24;
        }
        
        .country-stats {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }
        
        .country-stats strong {
            color: #333;
        }
        
        .auto-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #0167af;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 25px;
            font-size: 0.85rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .auto-refresh i {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .stat-number {
                font-size: 1.75rem;
            }
            
            .stat-icon {
                font-size: 1.5rem;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: auto;
            }
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .summary-card {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .summary-card h3 {
            color: #0167af;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }
        
        .summary-list {
            list-style: none;
            padding: 0;
        }
        
        .summary-list li {
            padding: 0.4rem 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .summary-list li:last-child {
            border-bottom: none;
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 0;
            overflow: hidden;
        }
        
        .tab-button {
            flex: 1;
            background: #f8f9fa;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .tab-button:hover {
            background: #e9ecef;
            color: #0167af;
        }
        
        .tab-button.active {
            background: white;
            color: #0167af;
            border-bottom-color: #0167af;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Timeline Tab Styles */
        .timeline-grid {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 2rem;
        }
        
        .timeline-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 100%;
        }
        
        .timeline-card-header {
            background: linear-gradient(135deg, #0167af 0%, #014d82 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timeline-card-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .timeline-card-coverage {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .timeline-card-body {
            padding: 1.5rem;
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }
        
        .timeline-chart {
            height: auto;
            flex: 2;
            min-width: 300px;
        }
        
        .timeline-stats {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            flex: 1;
            min-width: 200px;
        }
        
        .timeline-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .timeline-stat-value {
            font-weight: bold;
            font-size: 1.1rem;
            color: #0167af;
        }
        
        .timeline-stat-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }
        
        .timeline-legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            font-size: 0.85rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .legend-original { background-color: #28a745; }
        .legend-ai { background-color: #007bff; }
        .legend-gap { background-color: #dc3545; opacity: 0.3; }
        
        .no-timeline-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }
        
        @media (max-width: 768px) {
            .timeline-grid {
                padding: 1rem;
            }
            
            .timeline-card-body {
                flex-direction: column;
                gap: 1rem;
            }
            
            .timeline-chart {
                min-width: auto;
                height: 100px;
            }
            
            .timeline-stats {
                min-width: auto;
            }
            
            .timeline-legend {
                flex-wrap: wrap;
                justify-content: flex-start;
                gap: 1rem;
            }
            
            .tab-button {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
        }

        /* Data Tab Styles */
        .data-tab-container {
            background: white;
            border-radius: 0 0 10px 10px;
            min-height: 400px;
        }
        
        .data-tab-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .data-tab-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.3rem;
            font-weight: 600;
            color: #0167af;
        }
        
        .data-tab-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .data-tab-controls select,
        .data-tab-controls input {
            padding: 0.6rem 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            min-width: 150px;
        }
        
        .data-tab-controls select:focus,
        .data-tab-controls input:focus {
            outline: none;
            border-color: #0167af;
            box-shadow: 0 0 0 2px rgba(1, 103, 175, 0.1);
        }
        
        .data-tab-content {
            padding: 2rem;
            overflow-x: auto;
        }
        
        .data-tab-placeholder {
            text-align: center;
            color: #666;
            padding: 4rem 2rem;
        }
        
        .data-tab-placeholder p {
            font-size: 1.1rem;
            margin: 0;
        }
        
        .data-table-wrapper {
            overflow-x: auto;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background: white;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
            font-size: 0.85rem;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 0.75rem 0.5rem;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        
        .data-table th:hover {
            background: #e9ecef;
        }
        
        .data-table td {
            padding: 0.6rem 0.5rem;
            border-bottom: 1px solid #dee2e6;
            vertical-align: top;
            max-width: 200px;
            word-wrap: break-word;
        }
        
        .data-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tbody tr:hover {
            background: #e3f2fd;
        }
        
        .data-table .url-cell {
            max-width: 150px;
        }
        
        .data-table .url-cell a {
            color: #0167af;
            text-decoration: none;
            word-break: break-all;
        }
        
        .data-table .url-cell a:hover {
            text-decoration: underline;
        }
        
        .data-table .description-cell {
            max-width: 250px;
            line-height: 1.3;
        }
        
        .data-table .notes-cell {
            max-width: 300px;
            line-height: 1.3;
            font-size: 0.8rem;
        }
        
        .reliability-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .reliability-level-1 {
            background: #d4edda;
            color: #155724;
        }
        
        .reliability-level-2 {
            background: #cce7ff;
            color: #004085;
        }
        
        .reliability-level-3 {
            background: #fff3cd;
            color: #856404;
        }
        
        .reliability-level-4 {
            background: #f8d7da;
            color: #721c24;
        }
        
        .confidence-weight {
            font-weight: bold;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.8rem;
        }
        
        .confidence-high {
            background: #d4edda;
            color: #155724;
        }
        
        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .location-cell {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-width: 180px;
        }
        
        .data-tab-summary {
            background: #f8f9fa;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .data-tab-summary-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .data-tab-summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0167af;
        }
        
        .data-tab-summary-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .data-tab-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .data-tab-controls {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .data-tab-controls select,
            .data-tab-controls input {
                min-width: auto;
                width: 100%;
            }
            
            .data-tab-content {
                padding: 1rem;
            }
            
            .data-table {
                min-width: 600px;
            }
            
            .data-tab-summary {
                gap: 1rem;
            }
            
            .tab-navigation {
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .tab-button {
                min-width: max-content;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <img src="logo.png" alt="MOSAIC Logo" class="mosaic-logo">
            
            <div class="header-text">
                <h1>AI Enhanced Data Mining for Cholera Surveillance Gaps</h1>
                <p>Protocol Version 3.0 - 6-Agent Batch-Based Search Protocol</p>
                <p class="last-updated">Last Updated: <span id="last-updated"></span></p>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card completed">
                <i class="fas fa-check-circle stat-icon completed"></i>
                <div class="stat-content">
                    <div class="stat-number" id="completed-count">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>
            
            <div class="stat-card pending">
                <i class="fas fa-clock stat-icon pending"></i>
                <div class="stat-content">
                    <div class="stat-number" id="pending-count">0</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
            
            <div class="stat-card not-started">
                <i class="fas fa-circle stat-icon not-started"></i>
                <div class="stat-content">
                    <div class="stat-number" id="not-started-count">0</div>
                    <div class="stat-label">Not Started</div>
                </div>
            </div>
            
            <div class="stat-card overview">
                <i class="fas fa-globe-africa stat-icon overview"></i>
                <div class="stat-content">
                    <div class="stat-number" id="total-count">0</div>
                    <div class="stat-label">Total Countries</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <i class="fas fa-chart-line"></i>
                <span>Overall Progress</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">Loading...</div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <h3><i class="fas fa-trophy"></i> Recent Completions</h3>
                <ul class="summary-list" id="recent-completions">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
            
            <div class="summary-card">
                <h3><i class="fas fa-chart-bar"></i> Data Summary</h3>
                <ul class="summary-list" id="data-summary">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="showTab('country-status')">
                <i class="fas fa-table"></i>
                Country Status
            </button>
            <button class="tab-button" onclick="showTab('data-timelines')">
                <i class="fas fa-chart-line"></i>
                Data Coverage
            </button>
            <button class="tab-button" onclick="showTab('source-metadata')">
                <i class="fas fa-database"></i>
                Source Metadata
            </button>
            <button class="tab-button" onclick="showTab('cholera-data')">
                <i class="fas fa-list-alt"></i>
                Cholera Data
            </button>
        </div>

        <!-- Country Status Tab -->
        <div id="country-status" class="tab-content active">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fas fa-table"></i>
                        <span>Country Status</span>
                    </div>
                    <input type="text" class="search-box" id="searchInput" placeholder="Search countries..." onkeyup="filterTable()">
                </div>
                <div class="table-wrapper">
                    <table id="countryTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)">Country <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(1)">ISO <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(2)">Status <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(3)">Last Updated <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(4)">Data Summary <i class="fas fa-sort"></i></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Data Timelines Tab -->
        <div id="data-timelines" class="tab-content">
            <div class="timeline-grid" id="timeline-grid">
                <!-- Timeline cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Source Metadata Tab -->
        <div id="source-metadata" class="tab-content">
            <div class="data-tab-container">
                <div class="data-tab-header">
                    <div class="data-tab-title">
                        <i class="fas fa-database"></i>
                        Source Metadata
                    </div>
                    <div class="data-tab-controls">
                        <select id="metadata-country-select" onchange="loadMetadataData()">
                            <option value="">Select Country...</option>
                        </select>
                        <input type="text" id="metadata-search" placeholder="Search metadata..." onkeyup="filterMetadataTable()">
                    </div>
                </div>
                <div class="data-tab-content" id="metadata-content">
                    <div class="data-tab-placeholder">
                        <i class="fas fa-database" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <p>Select a country to view source metadata</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cholera Data Tab -->
        <div id="cholera-data" class="tab-content">
            <div class="data-tab-container">
                <div class="data-tab-header">
                    <div class="data-tab-title">
                        <i class="fas fa-list-alt"></i>
                        Cholera Data
                    </div>
                    <div class="data-tab-controls">
                        <select id="data-country-select" onchange="loadCholeraData()">
                            <option value="">Select Country...</option>
                        </select>
                        <input type="text" id="data-search" placeholder="Search data..." onkeyup="filterDataTable()">
                    </div>
                </div>
                <div class="data-tab-content" id="data-content">
                    <div class="data-tab-placeholder">
                        <i class="fas fa-list-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <p>Select a country to view cholera data</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="auto-refresh">
        <i class="fas fa-sync-alt"></i>
        <span>Auto-refresh: 30s</span>
    </div>

    <script>
        // Embedded CSV data - updated automatically by the Python script
        const csvData = `country,iso,status,datetime,sources,observations,date_range,priority,execution_time,queries,yield_pct,notes
Angola,AGO,COMPLETED,2025-07-21 22:23:00,24,34,1987-2025,LOW,0,3,2933.3,All agents executed; 34 data observations
Burundi,BDI,COMPLETED,2025-07-22 09:21:58,13,35,1986-2025,LOW,0,0,,Quality audit completed; 35 data observations
Benin,BEN,COMPLETED,2025-07-22 12:38:38,15,23,1996-2022,MEDIUM,0,0,,All agents executed; 23 data observations
Burkina Faso,BFA,COMPLETED,2025-07-22 15:49:51,11,12,1971-2021,HIGH,0,3,1500.0,All agents executed; 12 data observations
Botswana,BWA,PENDING,2025-07-22 20:42:33,2,1,2000-2023,HIGH,0,0,,Agent 1 completed; 1 data observations | Manual: Agent 1 completed
Central African Republic,CAF,PENDING,2025-07-22 10:57:15,0,0,,,0,0,,Agent 1 completed
Côte d'Ivoire,CIV,COMPLETED,2025-07-22 20:13:03,28,17,1991-2025,MEDIUM,0,0,,All agents executed; 17 data observations
Cameroon,CMR,COMPLETED,2025-07-22 15:03:50,24,33,2001-2024,LOW,0,0,,All agents executed; 33 data observations
Democratic Republic of Congo,COD,NOT_STARTED,,0,0,,,0,0,,No activity detected
Congo,COG,NOT_STARTED,,0,0,,,0,0,,No activity detected
Eritrea,ERI,NOT_STARTED,,0,0,,,0,0,,No activity detected
Ethiopia,ETH,PENDING,2025-07-22 18:35:48,0,0,,,0,0,,Agent 1 initialized - starting work
Gabon,GAB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Ghana,GHA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Guinea,GIN,NOT_STARTED,,0,0,,,0,0,,No activity detected
Gambia,GMB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Guinea-Bissau,GNB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Equatorial Guinea,GNQ,NOT_STARTED,,0,0,,,0,0,,No activity detected
Kenya,KEN,PENDING,2025-07-22 18:41:59,0,0,,,0,0,,Agent 1 initialized - starting work
Liberia,LBR,NOT_STARTED,,0,0,,,0,0,,No activity detected
Mali,MLI,NOT_STARTED,,0,0,,,0,0,,No activity detected
Mozambique,MOZ,NOT_STARTED,,0,0,,,0,0,,No activity detected
Mauritania,MRT,NOT_STARTED,,0,0,,,0,0,,No activity detected
Malawi,MWI,NOT_STARTED,,0,0,,,0,0,,No activity detected
Namibia,NAM,NOT_STARTED,,0,0,,,0,0,,No activity detected
Niger,NER,NOT_STARTED,,0,0,,,0,0,,No activity detected
Nigeria,NGA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Rwanda,RWA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Senegal,SEN,NOT_STARTED,,0,0,,,0,0,,No activity detected
Sierra Leone,SLE,NOT_STARTED,,0,0,,,0,0,,No activity detected
Somalia,SOM,NOT_STARTED,,0,0,,,0,0,,No activity detected
South Sudan,SSD,NOT_STARTED,,0,0,,,0,0,,No activity detected
Eswatini,SWZ,NOT_STARTED,,0,0,,,0,0,,No activity detected
Chad,TCD,NOT_STARTED,,0,0,,,0,0,,No activity detected
Togo,TGO,NOT_STARTED,,0,0,,,0,0,,No activity detected
Tanzania,TZA,NOT_STARTED,,0,0,,,0,0,,No activity detected
Uganda,UGA,NOT_STARTED,,0,0,,,0,0,,No activity detected
South Africa,ZAF,NOT_STARTED,,0,0,,,0,0,,No activity detected
Zambia,ZMB,NOT_STARTED,,0,0,,,0,0,,No activity detected
Zimbabwe,ZWE,NOT_STARTED,,0,0,,,0,0,,No activity detected`;

        let countryData = [];

        // Parse CSV data
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    const country = {};
                    headers.forEach((header, index) => {
                        country[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(country);
                }
            }
            return data;
        }

        // Parse a single CSV line handling commas in quoted fields
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        // Initialize dashboard
        function initializeDashboard() {
            countryData = parseCSV(csvData);
            updateStats();
            updateProgressBar();
            updateTable();
            updateSummaryCards();
            updateLastUpdated();
            
            // Initialize tabs - ensure Country Status tab is active by default
            document.querySelector('.tab-button').classList.add('active');
            document.getElementById('country-status').classList.add('active');
        }

        // Update statistics
        function updateStats() {
            const completed = countryData.filter(c => c.status === 'COMPLETED').length;
            const pending = countryData.filter(c => c.status === 'PENDING').length;
            const notStarted = countryData.filter(c => c.status === 'NOT_STARTED').length;
            const total = countryData.length;

            document.getElementById('completed-count').textContent = completed;
            document.getElementById('pending-count').textContent = pending;
            document.getElementById('not-started-count').textContent = notStarted;
            document.getElementById('total-count').textContent = total;
        }

        // Update progress bar
        function updateProgressBar() {
            const completed = countryData.filter(c => c.status === 'COMPLETED').length;
            const total = countryData.length;
            const progressPercent = total > 0 ? (completed / total * 100) : 0;

            document.getElementById('progress-bar').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = 
                `${progressPercent.toFixed(1)}% Complete (${completed} of ${total} countries)`;
        }

        // Update the countries table
        function updateTable() {
            const tbody = document.querySelector('#countryTable tbody');
            tbody.innerHTML = '';

            countryData.forEach(country => {
                const row = document.createElement('tr');
                
                const statusBadge = getStatusBadge(country.status);
                const stats = getStatsString(country);
                const lastUpdated = formatDate(country.datetime);
                
                row.innerHTML = `
                    <td><strong>${country.country || 'Unknown'}</strong></td>
                    <td><code>${country.iso || 'N/A'}</code></td>
                    <td>${statusBadge}</td>
                    <td>${lastUpdated}</td>
                    <td><div class="country-stats">${stats}</div></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Get status badge HTML
        function getStatusBadge(status) {
            const badges = {
                'COMPLETED': '<span class="status-badge status-completed"><i class="fas fa-check"></i> Completed</span>',
                'PENDING': '<span class="status-badge status-pending"><i class="fas fa-clock"></i> Pending</span>',
                'NOT_STARTED': '<span class="status-badge status-not-started"><i class="fas fa-circle"></i> Not Started</span>'
            };
            return badges[status] || badges['NOT_STARTED'];
        }

        // Get stats string
        function getStatsString(country) {
            if (country.status === 'COMPLETED') {
                const sources = country.sources || '0';
                const observations = country.observations || '0';
                const dateRange = country.date_range && country.date_range !== 'N/A' ? country.date_range : 'Unknown period';
                return `<strong>Sources:</strong> ${sources} | <strong>Observations:</strong> ${observations}<br><strong>Coverage:</strong> ${dateRange}`;
            } else if (country.status === 'PENDING') {
                return country.notes || 'Work in progress';
            }
            return 'No activity detected';
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString || dateString === 'N/A') {
                return '-';
            }
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch (e) {
                return dateString;
            }
        }

        // Update summary cards
        function updateSummaryCards() {
            // Recent completions
            const completed = countryData
                .filter(c => c.status === 'COMPLETED')
                .sort((a, b) => new Date(b.datetime) - new Date(a.datetime))
                .slice(0, 5);

            const recentList = document.getElementById('recent-completions');
            recentList.innerHTML = '';
            
            if (completed.length === 0) {
                recentList.innerHTML = '<li><span>No completions yet</span></li>';
            } else {
                completed.forEach(country => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span><strong>${country.country}</strong> (${country.iso})</span>
                        <span>${formatDate(country.datetime).split(' ')[0]}</span>
                    `;
                    recentList.appendChild(li);
                });
            }

            // Data summary
            const totalSources = countryData.reduce((sum, c) => sum + (parseInt(c.sources) || 0), 0);
            const totalObservations = countryData.reduce((sum, c) => sum + (parseInt(c.observations) || 0), 0);
            const avgSourcesPerCountry = completed.length > 0 ? Math.round(totalSources / completed.length) : 0;

            const dataSummary = document.getElementById('data-summary');
            dataSummary.innerHTML = `
                <li><span>Total Sources</span><span><strong>${totalSources}</strong></span></li>
                <li><span>Total Observations</span><span><strong>${totalObservations}</strong></span></li>
                <li><span>Avg Sources/Country</span><span><strong>${avgSourcesPerCountry}</strong></span></li>
                <li><span>Countries w/ Data</span><span><strong>${completed.length}</strong></span></li>
            `;
        }

        // Update last updated time
        function updateLastUpdated() {
            document.getElementById('last-updated').textContent = 
                new Date().toISOString().replace('T', ' ').substring(0, 19) + ' UTC';
        }

        // Search functionality
        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("countryTable");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    const txtValue = td.textContent || td.innerText;
                    tr[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
                }
            }
        }

        // Sort table functionality
        function sortTable(n) {
            const table = document.getElementById("countryTable");
            let switching = true;
            let dir = "asc";
            let switchcount = 0;
            
            while (switching) {
                switching = false;
                const rows = table.rows;
                
                for (let i = 1; i < (rows.length - 1); i++) {
                    let shouldSwitch = false;
                    const x = rows[i].getElementsByTagName("TD")[n];
                    const y = rows[i + 1].getElementsByTagName("TD")[n];
                    
                    let xContent = x.textContent || x.innerText;
                    let yContent = y.textContent || y.innerText;
                    
                    if (dir === "asc") {
                        if (xContent.toLowerCase() > yContent.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir === "desc") {
                        if (xContent.toLowerCase() < yContent.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount === 0 && dir === "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        // Auto refresh every 30 seconds
        setInterval(function(){
            location.reload();
        }, 30000);

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button
            const clickedButton = event.target.closest('.tab-button');
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // Load timeline data if switching to timelines tab
            if (tabName === 'data-timelines') {
                loadTimelineData();
            }
        }
        
        // Embedded week counts data - updated automatically by the Python script
        const weekCountsCSV = `country,iso_code,ai_weeks,who_weeks,jhu_weeks
Angola,AGO,1431,21,321
Burundi,BDI,1039,124,164
Benin,BEN,558,0,538
Burkina Faso,BFA,1055,0,482
Central African Republic,CAF,0,0,482
Côte d'Ivoire,CIV,489,0,469
Cameroon,CMR,662,0,672
Democratic Republic of Congo,COD,0,124,553
Congo,COG,0,0,378
Ethiopia,ETH,0,125,180
Ghana,GHA,0,36,511
Guinea,GIN,0,0,623
Guinea-Bissau,GNB,0,0,327
Kenya,KEN,0,125,320
Liberia,LBR,0,0,431
Mali,MLI,0,0,378
Mozambique,MOZ,0,125,287
Mauritania,MRT,0,0,171
Malawi,MWI,0,118,158
Niger,NER,0,0,399
Nigeria,NGA,0,121,446
Senegal,SEN,0,0,417
Sierra Leone,SLE,0,0,387
Somalia,SOM,0,125,137
South Sudan,SSD,0,51,348
Chad,TCD,0,0,430
Togo,TGO,0,66,343
Tanzania,TZA,0,122,239
Uganda,UGA,0,127,319
Zambia,ZMB,0,122,373
Zimbabwe,ZWE,0,119,268`;

        // Global variable to store week counts data
        let weekCountsData = {};
        
        // Load week counts from embedded CSV data
        function loadWeekCountsData() {
            const lines = weekCountsCSV.trim().split('\n');
            const headers = lines[0].split(',');
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const isoCode = values[1]; // iso_code column
                weekCountsData[isoCode] = {
                    aiWeeks: parseInt(values[2]) || 0,
                    whoWeeks: parseInt(values[3]) || 0,
                    jhuWeeks: parseInt(values[4]) || 0
                };
            }
        }
        
        // Get week summary for a country from loaded CSV data
        function getWeekSummaryForCountry(isoCode) {
            const data = weekCountsData[isoCode];
            if (data) {
                return `AI: ${data.aiWeeks} weeks | WHO: ${data.whoWeeks} weeks | JHU: ${data.jhuWeeks} weeks`;
            }
            return 'AI: 0 weeks | WHO: 0 weeks | JHU: 0 weeks';
        }
        
        // Load and display timeline data with PNG plots
        async function loadTimelineData() {
            const timelineGrid = document.getElementById('timeline-grid');
            
            // Load week counts data first
            loadWeekCountsData();
            
            // Check which countries have timeline plot files
            const availablePlots = [
                'AGO', 'BDI', 'BEN', 'BFA', 'CAF', 'CIV', 'CMR', 'COD', 'COG', 
                'ETH', 'GHA', 'GIN', 'GNB', 'KEN', 'LBR', 'MLI', 'MOZ', 'MRT', 
                'MWI', 'NER', 'NGA', 'SEN', 'SLE', 'SOM', 'SSD', 'TCD', 'TGO', 
                'TZA', 'UGA', 'ZMB', 'ZWE'
            ];
            
            // Filter to countries with timeline plots available
            const countriesWithPlots = countryData.filter(country => 
                availablePlots.includes(country.iso)
            );
            
            if (countriesWithPlots.length === 0) {
                timelineGrid.innerHTML = `
                    <div class="no-timeline-data">
                        <i class="fas fa-info-circle" style="font-size: 2rem; color: #666; margin-bottom: 1rem;"></i>
                        <p>No timeline visualizations available yet.</p>
                        <p>Timeline plots will appear as countries complete data collection.</p>
                    </div>
                `;
                return;
            }
            
            // Sort countries by completion status and name
            countriesWithPlots.sort((a, b) => {
                if (a.status !== b.status) {
                    if (a.status === 'COMPLETED') return -1;
                    if (b.status === 'COMPLETED') return 1;
                    return 0;
                }
                return a.country.localeCompare(b.country);
            });
            
            // Generate timeline cards for countries with plots
            let timelineHTML = '';
            
            countriesWithPlots.forEach(country => {
                const coverage = calculateCoverageInfo(country);
                const plotFilename = `${country.iso}_${country.country.replace(/\s+/g, '_')}_3sources_timeline.png`;
                const plotPath = `./timeline_plots/${plotFilename}`;
                
                // Calculate week summary like the plots show
                // For now, we'll use placeholder values since we don't have direct access to the weekly data
                // In a full implementation, this would query the actual data sources
                const weekSummary = getWeekSummaryForCountry(country.iso);
                
                timelineHTML += `
                    <div class="timeline-card">
                        <div class="timeline-card-header">
                            <div class="timeline-card-title">
                                ${country.country} (${country.iso})
                            </div>
                            <div class="timeline-card-coverage">
                                ${coverage.coverageText} | ${weekSummary}
                            </div>
                        </div>
                        <div class="timeline-card-body" style="flex-direction: column; gap: 1rem;">
                            <div class="timeline-chart-container" style="width: 100%; text-align: center;">
                                <img src="${plotPath}" 
                                     alt="Timeline coverage for ${country.country}" 
                                     style="max-width: 100%; height: auto;"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; align-items: center; justify-content: center; height: 200px; color: #666; font-style: italic; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px;">
                                    <i class="fas fa-chart-area" style="margin-right: 0.5rem;"></i>
                                    Timeline plot not available
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            timelineGrid.innerHTML = timelineHTML;
        }
        
        
        // Calculate coverage information for timeline display
        function calculateCoverageInfo(country, countryTimeline = {}) {
            const dateRange = country.date_range || '';
            const metrics = countryTimeline.coverage_metrics || {};
            
            let spanYears = 0;
            let coverageText = 'Unknown period';
            
            // Use metrics data if available
            if (metrics.total_span_years) {
                spanYears = Math.round(metrics.total_span_years * 10) / 10;
                coverageText = `${spanYears} year span`;
                
                if (metrics.original_coverage_pct) {
                    coverageText += ` (${metrics.original_coverage_pct.toFixed(1)}% coverage)`;
                }
            } else if (dateRange && dateRange !== 'Unknown period') {
                // Fallback to parsing date range
                const parts = dateRange.split('-');
                if (parts.length === 2) {
                    const startYear = parseInt(parts[0]);
                    const endYear = parseInt(parts[1]);
                    if (!isNaN(startYear) && !isNaN(endYear)) {
                        spanYears = endYear - startYear + 1;
                        coverageText = `${spanYears} year span`;
                    }
                }
            }
            
            return {
                spanYears: spanYears || 'N/A',
                coverageText: coverageText
            };
        }

        // Data storage for metadata and cholera data
        let metadataCache = {};
        let choleraDataCache = {};
        
        // Initialize country selects and populate with completed countries
        function initializeDataTabs() {
            const completedCountries = countryData
                .filter(c => c.status === 'COMPLETED')
                .sort((a, b) => a.country.localeCompare(b.country));
            
            // Populate metadata country select
            const metadataSelect = document.getElementById('metadata-country-select');
            metadataSelect.innerHTML = '<option value="">Select Country...</option>';
            completedCountries.forEach(country => {
                metadataSelect.innerHTML += `<option value="${country.iso}">${country.country} (${country.iso})</option>`;
            });
            
            // Populate cholera data country select
            const dataSelect = document.getElementById('data-country-select');
            dataSelect.innerHTML = '<option value="">Select Country...</option>';
            completedCountries.forEach(country => {
                dataSelect.innerHTML += `<option value="${country.iso}">${country.country} (${country.iso})</option>`;
            });
        }
        
        // Load and display metadata for selected country
        async function loadMetadataData() {
            const countryISO = document.getElementById('metadata-country-select').value;
            const contentDiv = document.getElementById('metadata-content');
            
            if (!countryISO) {
                contentDiv.innerHTML = `
                    <div class="data-tab-placeholder">
                        <i class="fas fa-database" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <p>Select a country to view source metadata</p>
                    </div>
                `;
                return;
            }
            
            // Show loading state
            contentDiv.innerHTML = `
                <div class="data-tab-placeholder">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #0167af; margin-bottom: 1rem;"></i>
                    <p>Loading metadata...</p>
                </div>
            `;
            
            try {
                // Try to load metadata file
                const response = await fetch(`../data/${countryISO}/metadata.csv`);
                if (!response.ok) {
                    throw new Error('File not found');
                }
                
                const csvText = await response.text();
                const metadata = parseMetadataCSV(csvText);
                metadataCache[countryISO] = metadata;
                
                displayMetadataTable(metadata, countryISO);
                
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="data-tab-placeholder">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc3545; margin-bottom: 1rem;"></i>
                        <p>Error loading metadata for ${countryISO}</p>
                        <p style="font-size: 0.9rem; color: #666;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Load and display cholera data for selected country
        async function loadCholeraData() {
            const countryISO = document.getElementById('data-country-select').value;
            const contentDiv = document.getElementById('data-content');
            
            if (!countryISO) {
                contentDiv.innerHTML = `
                    <div class="data-tab-placeholder">
                        <i class="fas fa-list-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <p>Select a country to view cholera data</p>
                    </div>
                `;
                return;
            }
            
            // Show loading state
            contentDiv.innerHTML = `
                <div class="data-tab-placeholder">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #0167af; margin-bottom: 1rem;"></i>
                    <p>Loading cholera data...</p>
                </div>
            `;
            
            try {
                // Try to load cholera data file
                const response = await fetch(`../data/${countryISO}/cholera_data.csv`);
                if (!response.ok) {
                    throw new Error('File not found');
                }
                
                const csvText = await response.text();
                const choleraData = parseCholeraDataCSV(csvText);
                choleraDataCache[countryISO] = choleraData;
                
                displayCholeraDataTable(choleraData, countryISO);
                
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="data-tab-placeholder">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc3545; margin-bottom: 1rem;"></i>
                        <p>Error loading cholera data for ${countryISO}</p>
                        <p style="font-size: 0.9rem; color: #666;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Parse metadata CSV with proper handling of quoted fields
        function parseMetadataCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) return [];
            
            const headers = parseCSVLine(lines[0]);
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(row);
                }
            }
            
            return data;
        }
        
        // Parse cholera data CSV with proper handling of quoted fields
        function parseCholeraDataCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) return [];
            
            const headers = parseCSVLine(lines[0]);
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(row);
                }
            }
            
            return data;
        }
        
        // Display metadata table
        function displayMetadataTable(metadata, countryISO) {
            const contentDiv = document.getElementById('metadata-content');
            const countryInfo = countryData.find(c => c.iso === countryISO);
            
            // Create summary
            const summaryHTML = `
                <div class="data-tab-summary">
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${metadata.length}</div>
                        <div class="data-tab-summary-label">Total Sources</div>
                    </div>
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${countryInfo ? countryInfo.date_range || 'N/A' : 'N/A'}</div>
                        <div class="data-tab-summary-label">Date Range</div>
                    </div>
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${metadata.filter(m => m.Reliability_Level === 'Level_1').length}</div>
                        <div class="data-tab-summary-label">Level 1 Sources</div>
                    </div>
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${metadata.filter(m => m.Status === 'Active').length}</div>
                        <div class="data-tab-summary-label">Active Sources</div>
                    </div>
                </div>
            `;
            
            // Create table
            let tableHTML = `
                <div class="data-table-wrapper">
                    <table class="data-table" id="metadata-table">
                        <thead>
                            <tr>
                                <th>Index</th>
                                <th>Source</th>
                                <th>URL</th>
                                <th>Description</th>
                                <th>Date Range</th>
                                <th>Reliability</th>
                                <th>Data Type</th>
                                <th>Language</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            metadata.forEach(row => {
                const reliabilityClass = (row.Reliability_Level || '').toLowerCase().replace('_', '-');
                const urlCell = row.URL ? `<a href="${row.URL}" target="_blank" title="${row.URL}">${truncateText(row.URL, 40)}</a>` : '-';
                
                tableHTML += `
                    <tr>
                        <td><strong>${row.Index || '-'}</strong></td>
                        <td><strong>${row.Source || '-'}</strong></td>
                        <td class="url-cell">${urlCell}</td>
                        <td class="description-cell">${row.Description || '-'}</td>
                        <td>${row.Date_Range || '-'}</td>
                        <td><span class="reliability-badge ${reliabilityClass}">${(row.Reliability_Level || 'Unknown').replace('_', ' ')}</span></td>
                        <td>${row.Data_Type || '-'}</td>
                        <td>${row.Language_Original || '-'}</td>
                        <td>${row.Status || '-'}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            contentDiv.innerHTML = summaryHTML + tableHTML;
        }
        
        // Display cholera data table
        function displayCholeraDataTable(choleraData, countryISO) {
            const contentDiv = document.getElementById('data-content');
            const countryInfo = countryData.find(c => c.iso === countryISO);
            
            // Calculate summary statistics
            const totalCases = choleraData.reduce((sum, row) => sum + (parseInt(row.sCh) || 0), 0);
            const totalDeaths = choleraData.reduce((sum, row) => sum + (parseInt(row.deaths) || 0), 0);
            const avgCFR = choleraData.filter(r => r.CFR && parseFloat(r.CFR) > 0)
                                   .reduce((sum, r, _, arr) => sum + parseFloat(r.CFR) / arr.length, 0);
            
            // Create summary
            const summaryHTML = `
                <div class="data-tab-summary">
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${choleraData.length}</div>
                        <div class="data-tab-summary-label">Total Observations</div>
                    </div>
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${totalCases.toLocaleString()}</div>
                        <div class="data-tab-summary-label">Total Cases</div>
                    </div>
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${totalDeaths.toLocaleString()}</div>
                        <div class="data-tab-summary-label">Total Deaths</div>
                    </div>
                    <div class="data-tab-summary-item">
                        <div class="data-tab-summary-value">${avgCFR.toFixed(1)}%</div>
                        <div class="data-tab-summary-label">Avg CFR</div>
                    </div>
                </div>
            `;
            
            // Create table
            let tableHTML = `
                <div class="data-table-wrapper">
                    <table class="data-table" id="cholera-data-table">
                        <thead>
                            <tr>
                                <th>Index</th>
                                <th>Location</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Cases (sCh)</th>
                                <th>Deaths</th>
                                <th>CFR</th>
                                <th>Source</th>
                                <th>Confidence</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            choleraData.forEach(row => {
                const confidenceValue = parseFloat(row.confidence_weight) || 0;
                const confidenceClass = confidenceValue >= 0.8 ? 'confidence-high' : 
                                       confidenceValue >= 0.5 ? 'confidence-medium' : 'confidence-low';
                
                tableHTML += `
                    <tr>
                        <td><strong>${row.Index || '-'}</strong></td>
                        <td class="location-cell">${row.Location || '-'}</td>
                        <td>${row.TL || '-'}</td>
                        <td>${row.TR || '-'}</td>
                        <td><strong>${row.sCh ? parseInt(row.sCh).toLocaleString() : '-'}</strong></td>
                        <td><strong>${row.deaths ? parseInt(row.deaths).toLocaleString() : '-'}</strong></td>
                        <td>${row.CFR ? parseFloat(row.CFR).toFixed(1) + '%' : '-'}</td>
                        <td>${truncateText(row.source || '-', 30)}</td>
                        <td><span class="confidence-weight ${confidenceClass}">${confidenceValue.toFixed(2)}</span></td>
                        <td class="notes-cell">${truncateText(row.processing_notes || '-', 100)}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            contentDiv.innerHTML = summaryHTML + tableHTML;
        }
        
        // Utility function to truncate text
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }
        
        // Filter metadata table
        function filterMetadataTable() {
            const input = document.getElementById('metadata-search');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('metadata-table');
            
            if (!table) return;
            
            const rows = table.getElementsByTagName('tr');
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toUpperCase().indexOf(filter) > -1) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }
        
        // Filter cholera data table
        function filterDataTable() {
            const input = document.getElementById('data-search');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('cholera-data-table');
            
            if (!table) return;
            
            const rows = table.getElementsByTagName('tr');
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toUpperCase().indexOf(filter) > -1) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            initializeDataTabs();
        });
    </script>
</body>
</html>